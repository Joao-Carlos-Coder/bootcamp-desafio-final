name: Gerar Imagens de Exemplo

# Este workflow também será acionado manualmente
on:
  workflow_dispatch:

jobs:
  generation:
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Pega o seu código do repositório
      - name: Checkout repository
        uses: actions/checkout@v4

      # Passo 2: Configura o ambiente Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # Passo 3: Instala todas as dependências (incluindo o novo matplotlib)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Passo 4: Baixa o modelo treinado do artefato do workflow anterior
      # ATENÇÃO: Verifique se o nome do artefato ('trained-cvae-model') é o mesmo
      # que você definiu no seu workflow de treinamento!
      - name: Download trained model artifact
        uses: actions/download-artifact@v4
        with:
          name: trained-cvae-model

      # Passo 5: Executa o novo script para gerar a imagem
      # O caminho para o modelo é o nome do artefato seguido pelo caminho original.
      - name: Run image generation script
        run: python generate_images.py --model-path model.pth

      # Passo 6: Salva a imagem gerada como um novo artefato
      - name: Upload generated image artifact
        uses: actions/upload-artifact@v4
        with:
          name: generated-digit-images
          path: generated_digits.png
